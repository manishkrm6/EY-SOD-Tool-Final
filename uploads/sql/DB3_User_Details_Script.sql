CREATE TABLE if not exists `user_details` (`uname` varchar(12) NOT NULL DEFAULT '',`user_name` varchar(100) DEFAULT NULL,`valid_from` varchar(12),`valid_to` varchar(12) DEFAULT NULL,`lockstatus` int DEFAULT NULL,`user_type` varchar(1) DEFAULT NULL,`user_group` varchar(12),`department` varchar(45) DEFAULT 'Not Specified',`manager` varchar(45) DEFAULT NULL,`suser` varchar(1) DEFAULT '0',`shared_id` varchar(1) DEFAULT '0',`generic_id` varchar(1) DEFAULT '0',`company` varchar(40) DEFAULT NULL,`location` varchar(45) DEFAULT NULL,`enabled` varchar(1) DEFAULT '1',`PASSWORD` varchar(250), `level2` varchar(100),`level3` varchar(100)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
truncate table `user_details`;
insert into user_details (uname,user_name,valid_from,valid_to,lockstatus,user_type,user_group,password) select distinct u.uname, name_text, valid_from,valid_to, case lockstatus when 0 then 0 when 128 then 0 else 1 end lockstatus, case user_type when 'A' then 1 when 'S' then 1 else 0 end user_type,user_group, u.uname from (select distinct uname from (select distinct uname from usr02 union select distinct uname from agr_users)u2)u  left join usr21 r on u.uname=r.uname left join adrp a on r.persnumber=a.persnumber left join usr02 ur on u.uname=ur.uname order by u.uname;
create index if not exists idx_ud on user_details(uname,valid_from,valid_to,lockstatus,user_type);

